<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹ˆì½œ í•˜íŠ¸ì˜ ì¹´í†¡</title>
    <meta name="description" content="ë‹ˆì½œ í•˜íŠ¸ì˜ ì¹´ì¹´ì˜¤í†¡ ì‹œë®¬ë ˆì´í„°ì…ë‹ˆë‹¤.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root{
            --ka-bg-chat:#b2c7d9; --ka-bubble-me:#fee500; --ka-bubble-you:#fff;
            --ka-text:#111; --ka-meta:#8e9aae; --ka-divider:#e5e5ea; --ka-main-bg:#f7f7f7; --ka-accent:#111;
            --status-bar-h:28px; --header-h:36px;
            --tabbar-h:56px; --composer-h:56px;
        }
        body{margin:0;background:#333;height:100vh;display:flex;align-items:center;justify-content:center;font-family:'Noto Sans KR',sans-serif}
        .phone{aspect-ratio:390/844;width:390px;height:844px;max-width:90vw;max-height:90vh;border:12px solid #000;border-radius:50px;background:#000;position:relative;box-shadow:0 0 30px rgba(0,0,0,.5)}
        .screen{width:100%;height:100%;border-radius:38px;overflow:hidden;display:flex;flex-direction:column;background:var(--ka-main-bg);color:var(--ka-text);position:relative}
        .page{position:absolute;inset:0;display:flex;flex-direction:column;opacity:0;visibility:hidden;transition:.2s}
        .page.active{opacity:1;visibility:visible;z-index:10}
        .status-bar{position:sticky;top:0;height:var(--status-bar-h);display:flex;align-items:center;justify-content:space-between;padding:0 20px;background:rgba(255,255,255,.95);backdrop-filter:blur(8px);z-index:30;font-size:13px;font-weight:600;}
        .app-header{position:sticky;top:var(--status-bar-h);z-index:25;background:#fff;border-bottom:1px solid var(--ka-divider);padding:6px 12px;font-weight:600;font-size:16px;display:flex;align-items:center;gap:8px;min-height:var(--header-h)}
        .app-header .back-btn{cursor:pointer;font-size:20px;padding:4px;}
        #friends .content-body,#chats .content-body,#profile-detail .content-body{padding-top:calc(var(--status-bar-h) + var(--header-h));background:#fff}
        #chat-detail .content-body{padding-top:calc(var(--status-bar-h) + var(--header-h));background:var(--ka-bg-chat)}
        .content-body{flex:1;overflow:auto;}
        .list{display:flex;flex-direction:column}
        .item{display:flex;align-items:center;gap:12px;padding:10px 14px;background:#fff;border-bottom:1px solid #f2f2f2;cursor:pointer}
        .item:last-child{border-bottom:none;}
        .item .info{display:flex;flex-direction:column;gap:3px;flex:1;overflow:hidden;}
        .item .info .name{font-weight:600;font-size:15px;}
        .item .info .subtext{font-size:13px;color:var(--ka-meta);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
        .avatar{width:42px;height:42px;border-radius:16px;overflow:hidden;display:flex;align-items:center;justify-content:center;font-weight:700;color:#fff;flex-shrink:0}
        .avatar.profile{width:70px;height:70px;border-radius:24px;}
        .avatar img{width:100%;height:100%;object-fit:cover}
        .avatar.fallback{background:#949aa1;font-size:18px;}
        .meta{margin-left:auto;font-size:12px;color:var(--ka-meta);display:flex;flex-direction:column;align-items:flex-end;gap:5px;align-self:flex-start;}
        .badge{min-width:18px;height:18px;padding:0 6px;background:#ff4d4f;color:#fff;border-radius:9px;font-size:12px;display:inline-flex;align-items:center;justify-content:center;font-weight:bold;}
        .divider{height:1px;background:var(--ka-divider);margin:8px 14px;}
        .my-profile .name{font-size:18px;} .my-profile .subtext{font-size:14px;}
        #profile-detail{background:#f0f0f0;justify-content:flex-end;}
        .profile-card{text-align:center;color:var(--ka-text);padding:80px 0 30px; margin-top:auto;}
        .profile-card .avatar.profile{margin:0 auto 16px; width:90px; height:90px; border-radius:30px;}
        .profile-card .name{font-size:20px;font-weight:600;}
        .profile-card .bio{font-size:15px;color:var(--ka-meta);margin-top:6px;}
        .profile-actions{display:flex;justify-content:center;gap:10px;padding:20px;border-top:1px solid var(--ka-divider);background:#f0f0f0;}
        .action-btn{cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:8px;font-size:12px;color:var(--ka-text);width:70px;}
        .action-btn .icon{width:28px;height:28px;background:rgba(0,0,0,0.05);border-radius:99px;display:flex;align-items:center;justify-content:center;font-size:16px;}
        .chat-body{display:flex;flex-direction:column;gap:12px;padding:14px;}
        .msg{display:flex;flex-direction:column;gap:4px;max-width:100%}
        .msg.me{align-items:flex-end} .msg.you{align-items:flex-start}
        .bubble{max-width:75%;padding:8px 12px;border-radius:16px;line-height:1.55;word-break:break-word;box-shadow:0 1px 0 rgba(0,0,0,.03)}
        .bubble.me{background:var(--ka-bubble-me);color:#111;margin-left:52px}
        .bubble.you{background:var(--ka-bubble-you);color:#111;margin-right:52px}
        .timestamp{font-size:10px;color:var(--ka-meta)}
        .timestamp.me{align-self:flex-end;margin-right:6px} .timestamp.you{align-self:flex-start;margin-left:6px}
        .bubble.me + .timestamp{align-self:flex-end;margin-right:6px}
        .tabbar{position:absolute;left:0;right:0;bottom:0;height:var(--tabbar-h);display:flex;align-items:center;justify-content:space-around;gap:8px;background:#f9f9f9;border-top:1px solid var(--ka-divider);z-index:40}
        .tab{flex:1;text-align:center;padding:10px 0;font-weight:700;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:12px;color:var(--ka-meta)}
        .tab.active{color:var(--ka-accent)}
        .tab .icon{font-size:20px;}
        .page .composer{display:none}
        #chat-detail .content-body{padding-bottom:calc(var(--composer-h) + 10px)}
        #chat-detail .composer{display:flex;position:absolute;left:0;right:0;bottom:0;height:var(--composer-h);background:#fff;border-top:1px solid var(--ka-divider);gap:8px;padding:8px 10px; align-items:center;}
        .composer input{flex:1;height:100%;box-sizing:border-box;padding:10px 12px;border:none;border-radius:12px;background:#f6f6f6;font-size:15px;}
        .composer button{padding:0 14px;border:none;border-radius:12px;background:var(--ka-bubble-me);color:var(--ka-text);font-weight:700;cursor:pointer;align-self:stretch;font-size:14px; transition: background .2s;}
        .composer input:not(:placeholder-shown) + button{background:var(--ka-accent); color:#fff;}
        .screen.chat-mode .tabbar{display:none}
    </style>
</head>
<body>
<div class="phone">
    <div class="screen">
        <div class="status-bar">
            <span id="clock">ì˜¤í›„ 9:41</span>
            <span>ğŸ“¶ LTE ğŸ”‹</span>
        </div>
        
        <div class="page active" id="friends">
            <header class="app-header">ì¹œêµ¬</header>
            <div class="content-body">
                <div class="list" id="friends-list"></div>
            </div>
        </div>

        <div class="page" id="chats">
            <header class="app-header">ì±„íŒ…</header>
            <div class="content-body">
                <div class="list" id="chats-list"></div>
            </div>
        </div>

        <div class="page" id="chat-detail">
            <header class="app-header">
                <span class="back-btn" onclick="showPage('chats')">â€¹</span>
                <span id="chat-header-name"></span>
            </header>
            <div class="content-body">
                <div class="chat-body" id="chat-body-content"></div>
            </div>
            <div class="composer">
                <input type="text" id="message-input" placeholder="ë©”ì‹œì§€ ì…ë ¥..." onkeyup="if(event.keyCode===13) sendMessage()">
                <button onclick="sendMessage()">ì „ì†¡</button>
            </div>
        </div>

        <div class="page" id="profile-detail">
            <header class="app-header" style="background:transparent; border:none; color:#111;">
                 <span class="back-btn" onclick="showPage('friends')">â€¹</span>
            </header>
            <div class="content-body" style="padding:0; background:transparent;">
                <div id="profile-card-content"></div>
                <div class="profile-actions" id="profile-actions-content"></div>
            </div>
        </div>
        
        <div class="tabbar">
            <div class="tab active" id="tab-friends" onclick="showPage('friends')">
                <span class="icon">ğŸ‘¤</span><span>ì¹œêµ¬</span>
            </div>
            <div class="tab" id="tab-chats" onclick="showPage('chats')">
                <span class="icon">ğŸ’¬</span><span>ì±„íŒ…</span>
            </div>
        </div>
    </div>
</div>

<script>
const now = new Date();
const phoneData = {
    me: {
        id: "me",
        name: "ë‹ˆì½œ í•˜íŠ¸",
        initial: "N",
        color: "#4a90e2",
        bio: "Math is the only universal language.",
        photoUrl: "https://image.pollinations.ai/prompt/glowing%20abstract%20fractal%20geometry"
    },
    friends: [
        { id: "raymon", name: "ë ˆì´ë¨¼ ë§¥ì¹´í„°", initial: "R", bio: "QB1 ğŸˆ | Asbury High", isFavorite: true, color: "#f5a623", photoUrl: "https://image.pollinations.ai/prompt/golden%20retriever%20wearing%20a%20tiny%20football%20helmet" },
        { id: "andy", name: "ì•¤ë”” ë¸”ë™", initial: "A", bio: "...", isFavorite: true, color: "#4a4a4a", photoUrl: "https://image.pollinations.ai/prompt/a%20sleek%20black%20cat%20with%20piercing%20green%20eyes" },
        { id: "justin", name: "ì €ìŠ¤í‹´ ë°€ëŸ¬", initial: "J", bio: "ìˆ˜í•™ í´ëŸ½ ğŸ“š", isFavorite: false, color: "#7ed321", photoUrl: "https://image.pollinations.ai/prompt/a%20stack%20of%20old%20math%20textbooks" },
        { id: "mom", name: "ì—„ë§ˆ", initial: "M", bio: "ë‚´ ì†Œì¤‘í•œ ì•„ë“¤â¤ï¸", isFavorite: false, color: "#d0021b", photoUrl: "https://image.pollinations.ai/prompt/a%20cozy%20knitted%20red%20sweater" },
        { id: "math_prez", name: "ìˆ˜í•™í´ëŸ½ íšŒì¥", initial: "íšŒ", bio: "Ï€ > e", isFavorite: false, color: "#bd10e0" },
        { id: "sarah", name: "ì‚¬ë¼ ìœŒë¦¬ì—„ìŠ¤", initial: "S", bio: "Music is my life ğŸ§", isFavorite: false, color: "#f8e71c", photoUrl: "https://image.pollinations.ai/prompt/vintage%20cassette%20tape" },
        { id: "jessica", name: "ì œì‹œì¹´ ì²¸", initial: "J", bio: "Life is short, eat dessert first.", isFavorite: false, color: "#e4a78a", photoUrl: "https://image.pollinations.ai/prompt/a%20cup%20of%20beautiful%20latte%20art" },
        { id: "mike", name: "ë§ˆì´í¬ í† ë ˆìŠ¤", initial: "M", bio: "Ball is life ğŸ€", isFavorite: false, color: "#f56a23", photoUrl: "https://image.pollinations.ai/prompt/a%20basketball%20on%20an%20outdoor%20court" },
        { id: "emma", name: "ì— ë§ˆ ë°ì´ë¹„ìŠ¤", initial: "E", bio: "Art student", isFavorite: false, color: "#50e3c2", photoUrl: "https://image.pollinations.ai/prompt/a%20paintbrush%20with%20colorful%20paint" },
        { id: "tyler", name: "íƒ€ì¼ëŸ¬ ì¡´ìŠ¨", initial: "T", bio: "Skate or die", isFavorite: false, color: "#9013fe", photoUrl: "https://image.pollinations.ai/prompt/a%20cool%20skateboard%20with%20graffiti" },
        { id: "coach_j", name: "ì¡´ìŠ¨ ì½”ì¹˜ë‹˜", initial: "ì½”", bio: "Asbury High Football Coach", isFavorite: false, color: "#053476", photoUrl: "https://image.pollinations.ai/prompt/a%20silver%20coach's%20whistle" }
    ],
    chats: [
        {
            id: "chat_raymon", with: "raymon", lastMessage: "ê¸ˆìš”ì¼ì— ë³´ì! ê¸°ëŒ€í• ê²Œ ğŸ˜‰", unread: 0, updatedAt: new Date(now.getTime() - 60000 * 2),
            messages: [
                { from: "you", text: "ë‹ˆí‚¤, ì–´ì œ ì˜í™”ë³¼ ë•Œ ì§„ì§œ ê·€ì—¬ì› ì–´ã…‹ã…‹", time: new Date(now.getTime() - 60000 * 120) },
                { from: "me", text: "ë­ë˜. ê·¸ëƒ¥ ì¢€ í”¼ê³¤í•´ì„œ ê·¸ë¬ì–´.", time: new Date(now.getTime() - 60000 * 119) },
                { from: "you", text: "í”¼ê³¤í•œ ì‚¬ëŒì´ ê·¸ë ‡ê²Œ ì–´ê¹¨ë¥¼ ë“¤ì©ì´ë©´ì„œ ë´? ğŸ˜‚", time: new Date(now.getTime() - 60000 * 118) },
                { from: "you", text: "ì•„ë¬´íŠ¼, ë„ˆë‘ ê°™ì´ ìˆìœ¼ë‹ˆê¹Œ ì¢‹ë”ë¼.", time: new Date(now.getTime() - 60000 * 117) },
                { from: "me", text: "...", time: new Date(now.getTime() - 60000 * 116) },
                { from: "me", text: "ë‚˜ë„.. ë‚˜ì˜ì§„ ì•Šì•˜ì–´.", time: new Date(now.getTime() - 60000 * 115) },
                { from: "you", text: "ë´ë´! ì†”ì§í•˜ì§ˆ ëª»í•´ìš” ì•„ì£¼", time: new Date(now.getTime() - 60000 * 114) },
                { from: "you", text: "ì´ë²ˆ ì£¼ ê¸ˆìš”ì¼ íŒŒí‹° ë§ì´ì•¼", time: new Date(now.getTime() - 60000 * 50) },
                { from: "you", text: "ì €ë… 7ì‹œë¶€í„° ì‹œì‘í• ê±°ì•¼. ë„ˆë¬´ ëŠ¦ê²Œ ì˜¤ì§€ ë§ˆ", time: new Date(now.getTime() - 60000 * 49) },
                { from: "me", text: "ì•Œì•˜ì–´. 7ì‹œ.", time: new Date(now.getTime() - 60000 * 48) },
                { from: "you", text: "ì• ë“¤ ë§ì´ ì˜¬ ê±´ë°, ë¶ˆí¸í•˜ë©´ ë‚˜ë‚˜ ì•¤ë”” ì˜†ì— ê¼­ ë¶™ì–´ìˆì–´", time: new Date(now.getTime() - 60000 * 47) },
                { from: "me", text: "ë‚´ê°€ ì• ë„ ì•„ë‹ˆê³ .. ê´œì°®ì•„.", time: new Date(now.getTime() - 60000 * 46) },
                { from: "you", text: "ìš°ë¦¬í•œí… ì•„ì§ ì• ê¸° ê°™ì€ë°? ã…‹ã…‹", time: new Date(now.getTime() - 60000 * 45) },
                { from: "me", text: "ã…¡ã…¡", time: new Date(now.getTime() - 60000 * 44) },
                { from: "you", text: "ì•Œì•˜ì–´ ì•Œì•˜ì–´ í™”ë‚´ì§€ë§ˆ", time: new Date(now.getTime() - 60000 * 43) },
                { from: "you", text: "ê·¸ë‚ ì€ ê³µë¶€ ìƒê°í•˜ì§€ ë§ê³  ê·¸ëƒ¥ í‘¹ ì‰¬ì–´. ì•Œì•˜ì§€?", time: new Date(now.getTime() - 60000 * 10) },
                { from: "me", text: "ì‘. ê·¸ëŸ´ê²Œ.", time: new Date(now.getTime() - 60000 * 9) },
                { from: "you", text: "ê¸ˆìš”ì¼ì— ë³´ì! ê¸°ëŒ€í• ê²Œ ğŸ˜‰", time: new Date(now.getTime() - 60000 * 2) },
            ]
        },
        {
            id: "chat_andy", with: "andy", lastMessage: "ê·¸ë˜.", unread: 1, updatedAt: new Date(now.getTime() - 60000 * 5),
            messages: [
                { from: "you", text: "ì–´ì œ ê·¸ë ‡ê²Œ ê¸´ì¥í•  ì¤„ì€ ëª°ëë„¤.", time: new Date(now.getTime() - 60000 * 150) },
                { from: "me", text: "ê¸´ì¥í•œ ê±° ì•„ë‹ˆë¼ê³ .", time: new Date(now.getTime() - 60000 * 149) },
                { from: "you", text: "ê·€ ë¹¨ê°œì§„ ê±´ ì–´ë–»ê²Œ ì„¤ëª…í•  ê±´ë°.", time: new Date(now.getTime() - 60000 * 148) },
                { from: "me", text: "ê·¸ê±´... ë°©ì´ ë”ì›Œì„œ ê·¸ë¬ì–´.", time: new Date(now.getTime() - 60000 * 147) },
                { from: "you", text: "í•‘ê³„.", time: new Date(now.getTime() - 60000 * 146) },
                { from: "you", text: "ì €ìŠ¤í‹´ì´ë‘ ìŠ¤í„°ë””ëŠ” ì–´ë• ì–´.", time: new Date(now.getTime() - 60000 * 80) },
                { from: "me", text: "ê·¸ëƒ¥.. ìˆ˜í•™ ë¬¸ì œ í’€ì—ˆì§€ ë­.", time: new Date(now.getTime() - 60000 * 79) },
                { from: "you", text: "ê±”ê°€ ë„ˆí•œí…Œ ë­ ì´ìƒí•œ ì§“ ì•ˆ í–ˆê³ ?", time: new Date(now.getTime() - 60000 * 78) },
                { from: "me", text: "ì „í˜€. ê·¸ëƒ¥ ìŠ¤í„°ë””ë§Œ í–ˆì–´.", time: new Date(now.getTime() - 60000 * 77) },
                { from: "you", text: "ê·¸ë˜.", time: new Date(now.getTime() - 60000 * 76) },
                { from: "you", text: "ê¸ˆìš”ì¼ì— ë ˆì´ë¨¼ ì§‘ì—ì„œ í•˜ëŠ” íŒŒí‹°.", time: new Date(now.getTime() - 60000 * 15) },
                { from: "you", text: "ì‹œë„ëŸ¬ìš¸ ê±°ì•¼. ê°ì˜¤í•´.", time: new Date(now.getTime() - 60000 * 14) },
                { from: "me", text: "ì•Œì•„. ê´œì°®ì•„.", time: new Date(now.getTime() - 60000 * 13) },
                { from: "you", text: "ë¶ˆí¸í•˜ë©´ ë‚˜í•œí…Œ ë§í•´.", time: new Date(now.getTime() - 60000 * 12) },
                { from: "me", text: "ì‘. ê³ ë§ˆì›Œ.", time: new Date(now.getTime() - 60000 * 11) },
                { from: "you", text: "ê·¸ë˜.", time: new Date(now.getTime() - 60000 * 5) },
            ]
        },
        {
            id: "group_math", with: "math_prez", lastMessage: "ë„¤, íšŒì¥ë‹˜.", unread: 0, updatedAt: new Date(now.getTime() - 60000 * 180),
            messages: [
                { from: "you", text: "ìˆ˜í•™ í´ëŸ½ ë©¤ë²„ë“¤ê»˜ ì•Œë¦½ë‹ˆë‹¤. ë‹¤ìŒ ì£¼ ê²½ì‹œëŒ€íšŒ ëŒ€ë¹„ ìµœì¢… ëª¨ì˜ê³ ì‚¬ê°€ í† ìš”ì¼ ì˜¤ì „ì— ìˆìŠµë‹ˆë‹¤.", time: new Date(now.getTime() - 60000 * 182) },
                { from: "you", text: "ëª¨ë‘ í•„ì°¸í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.", time: new Date(now.getTime() - 60000 * 181) },
                { from: "me", text: "ë„¤, íšŒì¥ë‹˜.", time: new Date(now.getTime() - 60000 * 180) },
            ]
        },
        {
            id: "chat_justin", with: "justin", lastMessage: "ê·¸ë˜. ë‹¤ìŒ ìŠ¤í„°ë”” ë•Œ ë³´ì.", unread: 0, updatedAt: new Date(now.getTime() - 60000 * 240),
            messages: [
                { from: "you", text: "ë‹ˆì½œ, ì–´ì œ ìŠ¤í„°ë”” ì •ë§ ê³ ë§ˆì› ì–´! ë„¤ ì„¤ëª… ë•ë¶„ì— ì–´ë ¤ìš´ ë¬¸ì œ ë‹¤ ì´í•´í–ˆì–´.", time: new Date(now.getTime() - 60000 * 243) },
                { from: "me", text: "ë³„ê±° ì•„ëƒ. ë‹¤ë“¤ ì—´ì‹¬íˆ í–ˆìœ¼ë‹ˆê¹Œ.", time: new Date(now.getTime() - 60000 * 242) },
                { from: "you", text: "ë‹¤ìŒì— ë˜ ê°™ì´ ìŠ¤í„°ë”” í•  ìˆ˜ ìˆì„ê¹Œ? ë„ˆë‘ í•˜ë©´ ì§‘ì¤‘ì´ ë” ì˜ ë˜ëŠ” ê²ƒ ê°™ì•„!", time: new Date(now.getTime() - 60000 * 241) },
                { from: "me", text: "ê·¸ë˜. ë‹¤ìŒ ìŠ¤í„°ë”” ë•Œ ë³´ì.", time: new Date(now.getTime() - 60000 * 240) },
            ]
        },
        {
            id: "chat_mom", with: "mom", lastMessage: "ë„¤ ì—„ë§ˆ, ê±±ì •ë§ˆì„¸ìš”. ì˜ ì±™ê²¨ë¨¹ê³  ìˆì–´ìš”.", unread: 0, updatedAt: new Date(now.getTime() - 60000 * 480),
            messages: [
                { from: "you", text: "ì•„ë“¤, ë°¥ì€ ì˜ ì±™ê²¨ ë¨¹ê³  ë‹¤ë‹ˆë‹ˆ? ì—„ë§ˆê°€ í•­ìƒ ê±±ì •ì´ì•¼.", time: new Date(now.getTime() - 60000 * 482) },
                { from: "you", text: "ê³µë¶€ë„ ì¢‹ì§€ë§Œ ê±´ê°•ì´ ìµœê³ ë€ë‹¤.", time: new Date(now.getTime() - 60000 * 481) },
                { from: "me", text: "ë„¤ ì—„ë§ˆ, ê±±ì •ë§ˆì„¸ìš”. ì˜ ì±™ê²¨ë¨¹ê³  ìˆì–´ìš”.", time: new Date(now.getTime() - 60000 * 480) },
            ]
        },
        {
            id: "chat_mike", with: "mike", lastMessage: "ë¯¸ì•ˆ, ì£¼ë§ì—” ì¢€ ë°”ë¹ ì„œ.", unread: 0, updatedAt: new Date(now.getTime() - 60000 * 900),
            messages: [
                { from: "you", text: "í—¤ì´ ë‹ˆì½œ, ì´ë²ˆ ì£¼ë§ì— ë†êµ¬ í•œ ê²Œì„ ì–´ë•Œ?", time: new Date(now.getTime() - 60000 * 901) },
                { from: "me", text: "ë¯¸ì•ˆ, ì£¼ë§ì—” ì¢€ ë°”ë¹ ì„œ.", time: new Date(now.getTime() - 60000 * 900) },
            ]
        },
        {
            id: "chat_jessica", with: "jessica", lastMessage: "ì‘, ë³´ë‚´ì¤„ê²Œ. ì ê¹ë§Œ.", unread: 0, updatedAt: new Date(now.getTime() - 60000 * 1500),
            messages: [
                { from: "you", text: "ë‹ˆì½œ, í˜¹ì‹œ ì–´ì œ ì—­ì‚¬ ìˆ˜ì—… í•„ê¸°í•œ ê±° ì‚¬ì§„ ì¢€ ë³´ë‚´ì¤„ ìˆ˜ ìˆì–´? ã… ã… ", time: new Date(now.getTime() - 60000 * 1501) },
                { from: "me", text: "ì‘, ë³´ë‚´ì¤„ê²Œ. ì ê¹ë§Œ.", time: new Date(now.getTime() - 60000 * 1500) },
            ]
        },
        {
            id: "chat_coach_j", with: "coach_j", lastMessage: "ê°ì‚¬í•©ë‹ˆë‹¤. ì €ë„ ì—´ì‹¬íˆ í•˜ê² ìŠµë‹ˆë‹¤.", unread: 0, updatedAt: new Date(now.getTime() - 60000 * 2500),
            messages: [
                { from: "you", text: "í•˜íŠ¸ í•™ìƒ, ìë„¤ ì„±ì í‘œë¥¼ ë´¤ë„¤. ì•„ì£¼ í›Œë¥­í•´. ìš°ë¦¬ íŒ€ ì„ ìˆ˜ë“¤ì—ê²Œë„ ì¢‹ì€ ê·€ê°ì´ ë˜ê³  ìˆì–´.", time: new Date(now.getTime() - 60000 * 2501) },
                { from: "me", text: "ê°ì‚¬í•©ë‹ˆë‹¤. ì €ë„ ì—´ì‹¬íˆ í•˜ê² ìŠµë‹ˆë‹¤.", time: new Date(now.getTime() - 60000 * 2500) },
            ]
        }
    ]
};

let currentChatId = null;
let currentOpenPage = 'friends';

function avatarEl(entity, isProfile = false) {
    const className = `avatar ${isProfile ? 'profile' : ''}`;
    if (entity.photoUrl) {
        return `<div class="${className}"><img src="${entity.photoUrl}" alt="${entity.name}"></div>`;
    }
    return `<div class="${className} fallback" style="background-color:${entity.color || '#949aa1'}">${entity.initial}</div>`;
}

function formatTime(t) {
    if(!t) return '';
    const date = new Date(t);
    return date.toLocaleString('ko-KR', { hour: 'numeric', minute: 'numeric', hour12: true });
}

function renderFriends() {
    const listEl = document.getElementById('friends-list');
    
    const myProfileHtml = `
        <div class="item my-profile" onclick="openProfile('${phoneData.me.id}')">
            ${avatarEl(phoneData.me, true)}
            <div class="info">
                <div class="name">${phoneData.me.name}</div>
                <div class="subtext">${phoneData.me.bio}</div>
            </div>
        </div>
        <div class="divider"></div>
    `;

    const sortedFriends = [...phoneData.friends].sort((a, b) => {
        if (a.isFavorite && !b.isFavorite) return -1;
        if (!a.isFavorite && b.isFavorite) return 1;
        return a.name.localeCompare(b.name);
    });

    const friendsHtml = sortedFriends.map(friend => `
        <div class="item" onclick="openProfile('${friend.id}')">
            ${avatarEl(friend)}
            <div class="info">
                <div class="name">${friend.name}</div>
                <div class="subtext">${friend.bio || ''}</div>
            </div>
        </div>
    `).join('');

    listEl.innerHTML = myProfileHtml + friendsHtml;
}

function renderChats() {
    const listEl = document.getElementById('chats-list');
    const sortedChats = [...phoneData.chats].sort((a, b) => b.updatedAt - a.updatedAt);
    const chatsHtml = sortedChats.map(chat => {
        const friend = phoneData.friends.find(f => f.id === chat.with);
        let chatPartner = friend || (chat.with === "math_prez" ? {name: "ìˆ˜í•™í´ëŸ½", initial: "ìˆ˜", color: "#bd10e0"} : {name: "ì•Œ ìˆ˜ ì—†ìŒ", initial:"?"});
        return `
        <div class="item" onclick="openChat('${chat.id}')">
            ${avatarEl(chatPartner)}
            <div class="info">
                <div class="name">${chatPartner.name}</div>
                <div class="subtext">${chat.lastMessage}</div>
            </div>
            <div class="meta">
                <span>${formatTime(chat.updatedAt)}</span>
                ${chat.unread > 0 ? `<div class="badge">${chat.unread}</div>` : ''}
            </div>
        </div>
    `}).join('');
    listEl.innerHTML = chatsHtml;
}

function renderChatDetail(chat) {
    const friend = phoneData.friends.find(f => f.id === chat.with);
    let chatPartner = friend || (chat.with === "math_prez" ? {name: "ìˆ˜í•™í´ëŸ½", initial: "ìˆ˜", color: "#bd10e0"} : {name: "ì•Œ ìˆ˜ ì—†ìŒ", initial:"?"});

    document.getElementById('chat-header-name').textContent = chatPartner.name;
    const chatBody = document.getElementById('chat-body-content');
    
    const messagesHtml = chat.messages.map(msg => {
        const fromClass = msg.from === 'me' ? 'me' : 'you';
        return `
            <div class="msg ${fromClass}">
                <div class="bubble ${fromClass}">${msg.text}</div>
                <div class="timestamp ${fromClass}">${formatTime(msg.time)}</div>
            </div>
        `;
    }).join('');

    chatBody.innerHTML = messagesHtml;
    chatBody.parentElement.scrollTop = chatBody.parentElement.scrollHeight;
}


function openProfile(entityId) {
    const isMe = entityId === phoneData.me.id;
    const entity = isMe ? phoneData.me : phoneData.friends.find(f => f.id === entityId);
    if (!entity) return;

    const profileCard = document.getElementById('profile-card-content');
    const profileActions = document.getElementById('profile-actions-content');

    profileCard.innerHTML = `
        <div class="profile-card">
            ${avatarEl(entity, true)}
            <div class="name">${entity.name}</div>
            <div class="bio">${entity.bio || ''}</div>
        </div>
    `;

    if (isMe) {
        profileActions.innerHTML = `
            <div class="action-btn">
                <div class="icon">âœï¸</div>
                <span>í”„ë¡œí•„ í¸ì§‘</span>
            </div>
        `;
    } else {
        profileActions.innerHTML = `
            <div class="action-btn" onclick="openChatByFriendId('${entity.id}')">
                <div class="icon">ğŸ’¬</div>
                <span>1:1 ì±„íŒ…</span>
            </div>
        `;
    }
    showPage('profile-detail');
}


function openChatByFriendId(friendId) {
    let chat = phoneData.chats.find(c => c.with === friendId);
    if (!chat) {
        chat = {
            id: 'chat_' + friendId,
            with: friendId,
            lastMessage: '',
            unread: 0,
            updatedAt: new Date(),
            messages: []
        };
        phoneData.chats.push(chat);
    }
    openChat(chat.id);
}

function openChat(chatId) {
    const chat = phoneData.chats.find(c => c.id === chatId);
    if (!chat) return;

    if (chat.unread > 0) {
        chat.unread = 0;
        renderChats();
    }
    
    currentChatId = chatId;
    renderChatDetail(chat);
    showPage('chat-detail');
}

function sendMessage() {
    const input = document.getElementById('message-input');
    const text = input.value.trim();
    if (!text || !currentChatId) return;

    const chat = phoneData.chats.find(c => c.id === currentChatId);
    if (!chat) return;

    const newMessage = {
        from: 'me',
        text: text,
        time: new Date()
    };
    
    chat.messages.push(newMessage);
    chat.lastMessage = text;
    chat.updatedAt = new Date();

    input.value = '';

    renderChatDetail(chat);
    renderChats(); // Re-render chat list to update order and preview
}

function showPage(id) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    const targetPage = document.getElementById(id);
    if (targetPage) targetPage.classList.add('active');
    
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    const targetTab = document.getElementById(`tab-${id}`);
    if (targetTab) targetTab.classList.add('active');

    const screen = document.querySelector('.screen');
    if (screen) {
        if (id === 'chat-detail') {
            screen.classList.add('chat-mode');
        } else {
            screen.classList.remove('chat-mode');
        }
    }
    currentOpenPage = id;
}

document.addEventListener('DOMContentLoaded', () => {
    renderFriends();
    renderChats();
    const clockEl = document.getElementById('clock');
    if(clockEl) {
       clockEl.textContent = formatTime(new Date());
       setInterval(() => {
           clockEl.textContent = formatTime(new Date());
       }, 60000);
    }
});
</script>
</body>
</html>